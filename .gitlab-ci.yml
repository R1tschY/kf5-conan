# Global things
cache:
  paths:
    - .venv*/
variables:
  CONAN_CHANNEL: stable
  CONAN_LOGIN_USERNAME: r1tschy
  CONAN_UPLOAD: https://api.bintray.com/conan/r1tschy/sailfishos
before_script:
  # route /builds to sb2
  - echo 'use_outside_path("/builds")' > $HOME/.sbrules
  # /builds with target exec policy
  - sudo sed -i 's%sbox_user_home_dir%"/builds", exec_policy_name = "Target"},{dir = sbox_user_home_dir%' /usr/share/scratchbox2/modes/sdk-build/config.lua

  # Install python devel to compile python packages
  - "dev/install-targets-inner zypper -qn in cmake openssl-devel python3-devel"
  # Create conan venv
  - "dev/build-targets-inner dev/commands/prepare-buildenv"

libssh:
  image: "coderus/sailfishos-platform-sdk:latest"
  script:
    - cd libssh
    - "../dev/buildenv armv7hl python ci_build.py"
    - "../dev/buildenv i486 python ci_build.py"
  only:
    changes:
      - "libssh/**/*"
      - ".gitlab-ci.yml"
      - "dev/**/*"
